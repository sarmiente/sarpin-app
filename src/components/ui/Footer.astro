---
import Logo from "../../assets/SARPIN_AGENCY.svg";
import Favicon from "../../assets/favicon.svg";

const FooterLinks = [
  {
    title: "Links",
    items: [
      { text: "Nosotros", href: "/nosotros" },
      { text: "Blog", href: "/blog" },
      { text: "Servicios", href: "/servicios" },
    ],
  },
  {
    title: "Legal",
    items: [
      { text: "Pol√≠tica de Privacidad", href: "/politica-privacidad" },
      { text: "T√©rminos y condiciones", href: "/terminos-condiciones" },
    ],
  },
];

const links = FooterLinks[0].items;
const legal = FooterLinks[1].items;
---

<footer class="space-y-5">
  <div class="grid grid-cols-1 md:grid-cols-2 bg-second/90 py-10">

    <!-- Left title -->
    <div class="m-auto flex flex-col items-center text-center md:text-left md:gap-2">
      <h1
        class="text-5xl md:text-5xl lg:text-8xl font-body"
        words-slide-from-left
        text-split
      >
        Trabajemos <br />
        Juntos <div class="inline-block animate-wave">üëã</div>
      </h1>
    </div>

    <!-- Right form -->
    <div class="m-auto flex flex-col items-center md:flex-row md:text-left md:gap-2 reveal font-body">

      <form
        id="form-brevo"
        class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-3xl mx-auto p-4 sm:p-6">

        <!-- Name -->
        <div class="flex flex-col border-b">
          <input
            type="text"
            id="nombre"
            name="NOMBRE"
            placeholder="Nombre Completo*"
            class="form-input w-full"
            required
          />
        </div>

        <!-- Email -->
        <div class="flex flex-col border-b">
          <input
            type="email"
            id="email"
            name="EMAIL"
            placeholder="Correo electr√≥nico *"
            class="form-input w-full"
            required
          />
        </div>

        <!-- WhatsApp -->
<div class="flex flex-col border-b">
  <input
    type="text"
    id="whatsapp"
    name="WHATSAPP"
    placeholder="WhatsApp (opcional)"
    class="form-input w-full"
  />
</div>


        <!-- Servicio -->
        <div class="flex flex-col md:col-span-2 border-b">
          <select
            id="servicio"
            name="SERVICIO"
            required
            class="form-input w-full text-dark"
          >
            <option value="">Selecciona un tema *</option>
            <option value="Desarrollo de Paginas Web">Desarrollo P√°ginas Web</option>
            <option value="Marketing Digital SEO">Marketing Digital / SEO</option>
            <option value="Dise√±o de Marca">Dise√±o de Marca</option>
          </select>
        </div>

        <!-- Mensaje -->
        <div class="flex flex-col md:col-span-2 border-b">
          <textarea
            id="mensaje"
            name="MENSAJE"
            rows="4"
            placeholder="¬øC√≥mo podemos ayudarte? D√©janos tu mensaje *"
            class="form-input w-full"
            required
          ></textarea>
        </div>

        <!-- User Source -->
        <div class="flex flex-col md:col-span-2">
          <label for="source" class="form-label mb-2">¬øC√≥mo escuchaste acerca de nosotros?</label>
          <div class="flex flex-col gap-4">

            <!-- Google -->
            <label class="flex items-center gap-2">
              <input
                value="Google" type="radio" name="USER_SOURCE"
                class="form-radio accent-main"
                required
              />
              <span>Google</span>
            </label>

            <!-- Redes Sociales -->
            <label class="flex items-center gap-2">
              <input
                value="Redes Sociales" type="radio" name="USER_SOURCE"
                class="form-radio accent-main"
                required
              />
              <span>Redes Sociales</span>
            </label>

            <!-- Checkbox -->
            <div class="form-check flex space-x-2">
              <input
                value="Agreed"
                type="checkbox"
                name="Agreed Privacy"
                id="privacy-policy"
                class="accent-main"
                required
              />
              <label for="privacy-policy" class="text-xs">
                Acepto los
                <a target="_blank" class="hover:underline hover:text-info" href="/terminos-condiciones">t√©rminos y condiciones</a> y la
                <a target="_blank" class="hover:underline hover:text-info" href="/politica-privacidad">pol√≠tica de privacidad</a>.
              </label>
            </div>

          </div>
        </div>

        <!-- Submit -->
        <div class="flex justify-end md:col-span-2">
          <button
            type="submit"
            class="bg-main px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition"
          >
            Enviar mensaje
          </button>
        </div>

      </form>
    </div>
  </div>

  <!-- Footer Links -->
  <div class="grid grid-cols-1 md:grid-cols-2">
    <div class="m-auto flex flex-col items-center text-center md:flex-row md:text-left md:gap-2">
      <Favicon class="size-10" />
      <p class="text-xl font-body">
        Transformamos su visi√≥n empresarial <br />
        en experiencias digitales √∫nicas.
      </p>
    </div>

    <div class="hidden md:grid grid-cols-2">
      <div>
        <p class="font-heading uppercase text-lg">Links</p>
        <ul>
          {links.map((item) => (
            <li class="group">
              <a href={item.href} class="font-body text-md hover:text-main">
                {item.text}
              </a>
              <div class="h-[0.2px] ml-auto duration-300 origin-left bg-main scale-x-20 group-hover:scale-x-100" />
            </li>
          ))}
        </ul>
      </div>

      <div>
        <p class="font-heading uppercase text-lg">Legal</p>
        <ul>
          {legal.map((item) => (
            <li class="group">
              <a href={item.href} class="font-body hover:text-main">{item.text}</a>
              <div class="h-[0.2px] ml-auto duration-300 origin-left bg-main scale-x-20 group-hover:scale-x-100" />
            </li>
          ))}
        </ul>
      </div>
    </div>
  </div>

  <!-- Logo -->
  <div class="mx-auto opacity-35">
    <a href="/">
      <Logo width="auto" height="auto" />
    </a>
  </div>
</footer>


<dialog id="responseDialogSection" class="mx-auto rounded-xl p-6 shadow-lg my-auto">
      <p id="responseMessageSection" class="font-body"></p>
        <form method="dialog">
          <button class="mt-4 px-4 py-2 rounded-lg bg-blue-600 text-white">Cerrar</button>
        </form>
</dialog>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("form-brevo");
    const dialog = document.getElementById("responseDialogSection");
    const messageEl = document.getElementById("responseMessageSection");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const data = new FormData(form);

      const payload = {
        nombre: data.get("NOMBRE"),
        apellidos: data.get("APELLIDOS") || "",
        email: data.get("EMAIL"),
        whatsapp: data.get("WHATSAPP")
          ? "+57" + data.get("WHATSAPP").replace(/\D/g, "")
          : "",
        servicio: data.get("SERVICIO"),
        mensaje: data.get("MENSAJE"),
        userSource: data.get("USER_SOURCE") || "",
        listId: 8,
      };

      try {
        const response = await fetch("/api/contact", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Cache-Control": "no-store, no-cache, must-revalidate, proxy-revalidate",
            Pragma: "no-cache",
          },
          body: JSON.stringify(payload),
        });

        const result = await response.json();

        // ‚úÖ Better user feedback
        if (response.ok) {
          messageEl.textContent =
            "‚úÖ ¬°Gracias por tu mensaje! Nos comunicaremos a la mayor brevedad posible.";
          messageEl.className = "font-body text-green-600";
          form.reset();
        } else {
          messageEl.textContent =
            "‚ö†Ô∏è Hubo un error: " +
            (result.error?.message || result.error || "Intenta de nuevo.");
          messageEl.className = "font-body text-red-600";
        }

        dialog.showModal();
      } catch (error) {
        console.error(error);
        messageEl.textContent =
          "‚ùå Error en la conexi√≥n con el servidor. Por favor, int√©ntalo m√°s tarde.";
        messageEl.className = "font-body text-red-600";
        dialog.showModal();
      }
    });
  });
</script>
